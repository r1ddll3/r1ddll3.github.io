<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><meta name=keywords content="Malware Analysis,Reverse engineering,SkullLocker"><meta name=author content="@R1ddl3"><link rel=canonical href=https://r1ddll3.github.io/malware-analysis/skulllocker/><meta name=google-site-verification content="CTFS - Security Blog | Hacking | Malware Analysis | SOC Analyst | Blue Team | Defenders"><meta name=yandex-verification content="CTFS - Security Blog | Hacking | Malware Analysis | SOC Analyst | Blue Team | Defenders"><meta name=msvalidate.01 content="CTFS - Security Blog | Hacking | Malware Analysis | SOC Analyst | Blue Team | Defenders"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><link crossorigin=anonymous href=/css/core/vendorStyle.css integrity rel="preload stylesheet" as=style><link rel=icon href=https://i.ibb.co/DWKRt3n/b.png><link rel=icon type=image/png sizes=16x16 href=https://r1ddll3.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://r1ddll3.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://r1ddll3.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://r1ddll3.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Analyze - SkullLocker Ransomware"><meta property="og:description" content="Full Analysis - SkullLocker"><meta property="og:type" content="article"><meta property="og:url" content="https://r1ddll3.github.io/malware-analysis/skulllocker/"><meta property="og:image" content="https://www.2-viruses.com/wp-content/uploads/2017/07/SkullLocker-Screenlocker-virus.png"><meta property="article:section" content="Malware-Analysis"><meta property="article:published_time" content="2023-03-11T06:53:09+02:00"><meta property="article:modified_time" content="2023-03-11T06:53:09+02:00"><meta property="og:site_name" content="R1ddl3"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.2-viruses.com/wp-content/uploads/2017/07/SkullLocker-Screenlocker-virus.png"><meta name=twitter:title content="Analyze - SkullLocker Ransomware"><meta name=twitter:description content="Full Analysis - SkullLocker"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Malware-Analyses","item":"https://r1ddll3.github.io/malware-analysis/"},{"@type":"ListItem","position":3,"name":"Analyze - SkullLocker Ransomware","item":"https://r1ddll3.github.io/malware-analysis/skulllocker/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Analyze - SkullLocker Ransomware","name":"Analyze - SkullLocker Ransomware","description":"Full Analysis - SkullLocker","keywords":["Malware Analysis","Reverse engineering","SkullLocker"],"articleBody":"Analyze - SkullLockerRansomware SkullLocker is a new variant of the Chaos ransomware family. Ransomware is spread using various techniques such as spam emails and fake torrent sites. This particular type of ransomware encrypts files and adds a “.skull” extension to filenames.\nOverview The malware is coded using .NET we can determine that using Detect it easy(DiE) Tool: Code analysis The malware doesn’t come packed or something we can just decompile it using dnSpy and start analyzing the code and see its behavior and capabilities.\nAt the beginning the malware defines some variables which the author can edit and customize the malware like, (Message, processName, spreadName and Ransomware text message)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 userName = Environment.UserName; userDir = \"C:\\\\Users\\\\\"; appMutexRun = \"7z459ajrk722yn8c5j4fg\"; encryptionAesRsa = true; encryptedFileExtension = \"skull\"; checkSpread = true; spreadName = \"skull.exe\"; checkCopyRoaming = true; processName = \"svchost.exe\"; appMutexRun2 = \"2X28tfRmWaPyPQgvoHV\"; checkStartupFolder = true; checkSleep = true; sleepTextbox = 10; base64Image = \"#base64Image\"; appMutexStartup = \"1qw0ll8p9m8uezhqhyd\"; droppedMessageTextbox = \"read_it.txt\"; checkAdminPrivilage = true; checkdeleteShadowCopies = true; checkdisableRecoveryMode = true; checkdeleteBackupCatalog = true; appMutexStartup2 = \"17CqMQFeuB3NTzJ\"; appMutex2 = Program.appMutexStartup2 + Program.appMutexRun2; staticSplit = \"bc\"; appMutex = Program.staticSplit + Program.appMutexStartup + Program.appMutexRun; Already Running First, the malware defines a method called AlreadyRunning which checks if there is already an instance of the current process running.\nThe method first uses Process.GetProcesses() to get a list of all currently running processes. It then uses Process.GetCurrentProcess() to get a reference to the current process.\nThe method then iterates through each of the processes in the list and checks if the first module in the process’s module collection has the same file name as the current executing assembly(Malware), which is obtained using Assembly.GetExecutingAssembly().Location, Assembly.GetExecutingAssembly().Location will return the full path of the malware.\nIf a process is found that matches these conditions, the method returns true and the application will exit. If no matching process is found, the method returns false.\nCheck Admin Privilege 1 2 3 4 if (Program.checkAdminPrivilage) { Program.copyResistForAdmin(Program.processName); } If we take a look at copyResistForAdmin method private static string processName = \"svchost.exe\"; We know that the processName is svchost.exe so this method attempts to copy the current executable to a location within the user’s /AppData/Roaming/ folder using a filename of svchost.exe. Since svchost.exe is a legitimate system process, this an attempt by malware to disguise itself as a legitimate system process and avoid detection. Once the malware has copied itself to the new location and is running as an administrator, it could use this persistence mechanism to remain undetected and ensure that the malware can persist on the victim’s machine even after a system reboot or shutdown and if an exception occurs when attempting to start the new process with elevated privileges (the user declines the UAC prompt), the method recursively calls itself using the same processName argument.\naddLinkToStartup This code defines a static method called addLinkToStartup that adds a shortcut to the current executable to %USERPROFILE%\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu and the name of the shortcut is svchost.url. This method essentially ensures that the current executable will run every time the user logs into the system, making it a persistence mechanism.\nEncrypt Directories This method is responsible for encrypting directories in the given location. if we take a look at lookForDirectories and it calls method named encryptDirectory and this method gets a list of all files in the given location using .GetFiles function, then loops through each file and this if (Array.Exists(Program.validExtensions, (string E) =\u003e E == extension.ToLower()) \u0026\u0026 fileName != Program.droppedMessageTextbox) checks if the file extension is in the validExtensions array and is not the droppedMessageTextbox and we know that droppedMessageTextbox = \"read_it.txt\"; and this file read_it.txt has the message that the victim sees after the encryption process finished. And these are the targeted folders Also these are the validExtensions\n1 \".txt\",\".jar\",\".dat\",\".contact\",\".settings\",\".doc\",\".docx\",\".xls\",\".xlsx\",\".ppt\",\".pptx\",\".odt\",\".jpg\",\".mka\",\".mhtml\",\".oqy\",\".png\",\".csv\",\".py\",\".sql\",\".mdb\",\".php\",\".asp\",\".aspx\",\".html\",\".htm\",\".xml\",\".psd\",\".pdf\",\".xla\",\".cub\",\".dae\",\".indd\",\".cs\",\".mp3\",\".mp4\",\".dwg\",\".zip\",\".rar\",\".mov\",\".rtf\",\".bmp\",\".mkv\",\".avi\",\".apk\",\".lnk\",\".dib\",\".dic\",\".dif\",\".divx\",\".iso\",\".7zip\",\".ace\",\".arj\",\".bz2\",\".cab\",\".gzip\",\".lzh\",\".tar\",\".jpeg\",\".xz\",\".mpeg\",\".torrent\",\".mpg\",\".core\",\".pdb\",\".ico\",\".pas\",\".db\",\".wmv\",\".swf\",\".cer\",\".bak\",\".backup\",\".accdb\",\".bay\",\".p7c\",\".exif\",\".vss\",\".raw\",\".m4a\",\".wma\",\".flv\",\".sie\",\".sum\",\".ibank\",\".wallet\",\".css\",\".js\",\".rb\",\".crt\",\".xlsm\",\".xlsb\",\".7z\",\".cpp\",\".java\",\".jpe\",\".ini\",\".blob\",\".wps\",\".docm\",\".wav\",\".3gp\",\".webm\",\".m4v\",\".amv\",\".m4p\",\".svg\",\".ods\",\".bk\",\".vdi\",\".vmdk\",\".onepkg\",\".accde\",\".jsp\",\".json\",\".gif\",\".log\",\".gz\",\".config\",\".vb\",\".m1v\",\".sln\",\".pst\",\".obj\",\".xlam\",\".djvu\",\".inc\",\".cvs\",\".dbf\",\".tbi\",\".wpd\",\".dot\",\".dotx\",\".xltx\",\".pptm\",\".potx\",\".potm\",\".pot\",\".xlw\",\".xps\",\".xsd\",\".xsf\",\".xsl\",\".kmz\",\".accdr\",\".stm\",\".accdt\",\".ppam\",\".pps\",\".ppsm\",\".1cd\",\".3ds\",\".3fr\",\".3g2\",\".accda\",\".accdc\",\".accdw\",\".adp\",\".ai\",\".ai3\",\".ai4\",\".ai5\",\".ai6\",\".ai7\",\".ai8\",\".arw\",\".ascx\",\".asm\",\".asmx\",\".avs\",\".bin\",\".cfm\",\".dbx\",\".dcm\",\".dcr\",\".pict\",\".rgbe\",\".dwt\",\".f4v\",\".exr\",\".kwm\",\".max\",\".mda\",\".mde\",\".mdf\",\".mdw\",\".mht\",\".mpv\",\".msg\",\".myi\",\".nef\",\".odc\",\".geo\",\".swift\",\".odm\",\".odp\",\".oft\",\".orf\",\".pfx\",\".p12\",\".pl\",\".pls\",\".safe\",\".tab\",\".vbs\",\".xlk\",\".xlm\",\".xlt\",\".xltm\",\".svgz\",\".slk\",\".tar.gz\",\".dmg\",\".ps\",\".psb\",\".tif\",\".rss\",\".key\",\".vob\",\".epsp\",\".dc3\",\".iff\",\".onepkg\",\".onetoc2\",\".opt\",\".p7b\",\".pam\",\".r3d\" if the file size is less than 2MB it is encrypted using the EncryptFile method and if the size is bigger than 200 MB a random string of a random length between 200000000 and 300000000 bytes is generated and encoded using the randomEncode method after that, the original file renamed to a random 4-character extension using RandomStringForExtension.\nEncrypt File used to encrypt a file using AES encryption algorithm with a randomly generated password. The method reads the contents of the file into a byte array, generates a random password using the CreatePassword method, and converts the password to a byte array using UTF8 encoding. The method then writes the encrypted key and the encrypted content to the file. The encrypted key is the RSA encrypted random password generated earlier, and the encrypted content is the output of the AES encryption. Both of these are concatenated and written to the file using the File.WriteAllText method. Finally, the method renames the original file by appending a random extension using the RandomStringForExtension method\nRegistry Startup This method adds the path of the current executable to the Windows registry SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run named Microsoft Store also used for persistence.\nSpread It private static string spreadName = \"skull.exe\"; This code is responsible for spreading the malware to other drives on the victim’s machine. It loops through all the available drives on the system using the DriveInfo.GetDrives() method and checks if the drive is not the C:\\ drive and if a file with the spreadName doesn’t exist in that drive. If both conditions are true, it copies the malware’s executable file to that drive with the specified spreadName. This way, the malware can potentially infect other machines or systems that are connected to those drives.\nMalware Message This code is responsible for creating a file with droppedMessageTextbox value and we already know the name of the file private static string droppedMessageTextbox = \"read_it.txt\"; and then write the content of the Program.messages value into it and then open the file to the victim to let him know that his files have been encrypted. The message variable written in polish translate it by yourself :D 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 Witaj, Twoje pliki zostały zaszyfrowane przez SkullLocker ransomware. Aby odzyskać dostęp do nich musizapłacić okup w ciągu 72 godzin. W przeciwnym razie dane zostaną trwale utracone. Aby uzyskać więcej informacji na temat sposobu zapłaty okupu i odzyskiwania plików przejdź na stronę internetową podaną poniżej. U6cQ2nV4KzL3H8jxSdGhTfMlR0N1wX7eJbO9mZyIaP5pgqWvEoBkYtAxDsFi.onion Jeśli masz jakiekolwiek pytania możesz skontaktować się z nami za pomocą adresu e-mail [adres e-mail]. Nie próbuj usuwać programu ransomware ani próbować odzyskać danych za pomocą oprogramowania antywirusowego. Może to spowodować trwałe uszkodzenie Twoich plików. Pamiętaj że czas jest kluczowy. Im dłużej zwlekasz tym mniejsze szanse na odzyskanie Twoich plików. Pozdrawiamy Zespół ransomware Ransom Wallet Addresses The code first reads the current contents of the clipboard using a method called GetText from a NotificationForm object. If the clipboard text starts with the string “bc1”, the code seems to be manipulating the contents of the clipboard to ensure that certain strings are present or replaced with specific values and the values are stored in appMutex2 and appMutex if we went back to the variables that at the beginning we will notice that appMutex = Program.staticSplit + Program.appMutexStartup + Program.appMutexRun;and appMutex2 = Program.appMutexStartup2 + Program.appMutexRun2;after we concatenate these values together we will get 2 Bitcoin Wallets So, using Threat Intel we can determine if there is wallet with this address by going to Blockchain. Change Wallpaper First base64Image has the base64 of the wallpaper then it attempts to write the decoded bytes to a temporary file with a random name and a “.jpg” extension. Then, it calls the SystemParametersInfo function with the parameters 20U (indicating that the desktop wallpaper should be changed), 0U (indicating that the wallpaper should be changed immediately), the path to the temporary file, and 3U (indicating that the wallpaper should be tiled).\nDelete Shadow Copies 1 2 3 4 private static void deleteShadowCopies() { Program.runCommand(\"vssadmin delete shadows /all /quiet \u0026 wmic shadowcopy delete\"); } This code invokes two command-line tools, vssadmin and wmic, to delete all the existing shadow copies on the victim’s machine. The code is effectively preventing the victim from restoring their data using the shadow copies.\nDelete backup 1 2 3 4 private static void deleteBackupCatalog() { Program.runCommand(\"wbadmin delete catalog -quiet\"); } This command is used to delete the backup catalog on a local Windows computer without prompting the user for confirmation.\nMapping to MITRE ID Tactics Technique Description T1547.001 Persistence, Privilege Escalation Boot or Logon Autostart Execution Adversaries may achieve persistence by adding a program to a startup folder or referencing it with a Registry run key. Adding an entry to the “run keys” in the Registry or startup folder will cause the program referenced to be executed when a user logs in. These programs will be executed under the context of the user and will have the account’s associated permissions level. Placing a program within a startup folder will also cause that program to execute when a user logs in. There is a startup folder location for individual user accounts as well as a system-wide startup folder that will be checked regardless of which user account logs in. The startup folder path for the current user is C:\\Users[Username]\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup T1037.005 Persistence, Privilege Escalation Boot or Logon Initialization Scripts Adversaries may use scripts automatically executed at boot or logon initialization to establish persistence. Initialization scripts can be used to perform administrative functions, which may often execute other programs or send information to an internal logging server. These scripts can vary based on operating system and whether applied locally or remotely. T1027 Defense Evasion Obfuscated Files or Information Encode data using Base64, Encrypt data using AES via .NET T1070.004 Defense Evasion Indicator Removal: File Deletion Adversaries may delete files left behind by the actions of their intrusion activity. Deletes the backup plan of Windows, Deletes shadow drive data (related to ransomware) T1471 Impact Data Encrypted for Impact The adversary is trying to manipulate, interrupt, or destroy your devices and data and hold it for ransom IOCs Indicator Type Value SHA256 bb5ca9d8de51734dbd14dc081c7c892d819cd14fafd7ccd62849d70f9e679369 Yara Rule rule skull_locker { meta: author = \"R1ddl3\" description = \"Yara rule for detecting SkullLocker Ransomware\" hash = \"bb5ca9d8de51734dbd14dc081c7c892d819cd14fafd7ccd62849d70f9e679369\" strings: $mz = { 4D 5A } // PE file $str1 = \"skull.exe\" $str2 = \"checkCopyRoaming\" $str3 = \"appMutexRegex\" $str4 = \"copyResistForAdmin\" $str5 = \"deleteShadowCopies\" $str6 = \"lookForDirectories\" $str7 = \"spreadIt\" $str8 = \"appMutexRun2\" $str9 = \"appMutexRun\" $str10 = \"checkSpread\" condition: ($mz at 0) and (4 of ($str*)) and (hash.sha256() == $hash or not $hash) } – Thanks for reading, hope you enjoyed.\n","wordCount":"1787","inLanguage":"en","image":"https://www.2-viruses.com/wp-content/uploads/2017/07/SkullLocker-Screenlocker-virus.png","datePublished":"2023-03-11T06:53:09+02:00","dateModified":"2023-03-11T06:53:09+02:00","author":{"@type":"Person","name":"@R1ddl3"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://r1ddll3.github.io/malware-analysis/skulllocker/"},"publisher":{"@type":"Organization","name":"R1ddl3","logo":{"@type":"ImageObject","url":"https://i.ibb.co/DWKRt3n/b.png"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://r1ddll3.github.io accesskey=h title="R1ddl3 (Alt + H)"><img src=https://r1ddll3.github.io/apple-touch-icon.png alt aria-label=logo height=35>R1ddl3</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://r1ddll3.github.io/ctfs/ title=CTFs><span>CTFs</span></a></li><li><a href=https://r1ddll3.github.io/dfir/ title=DFIR><span>DFIR</span></a></li><li><a href=https://r1ddll3.github.io/malware-analysis/ title="Malware Analysis"><span>Malware Analysis</span></a></li><li><a href=https://r1ddll3.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://r1ddll3.github.io/threatintel/ title="Threat Intel"><span>Threat Intel</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://r1ddll3.github.io>Home</a>&nbsp;»&nbsp;<a href=https://r1ddll3.github.io/malware-analysis/>Malware-Analyses</a></div><h1 class=post-title>Analyze - SkullLocker Ransomware</h1><div class=post-description>Full Analysis - SkullLocker</div><div class=post-meta><span title='2023-03-11 06:53:09 +0200 +0200'>March 11, 2023</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1787 words&nbsp;·&nbsp;@R1ddl3</div></header><div class=post-content><h2 id=analyze---skulllockerransomware>Analyze - SkullLockerRansomware<a hidden class=anchor aria-hidden=true href=#analyze---skulllockerransomware>#</a></h2><p><strong>SkullLocker</strong> is a new variant of the Chaos ransomware family. Ransomware is spread using various techniques such as spam emails and fake torrent sites. This particular type of ransomware encrypts files and adds a &ldquo;.skull&rdquo; extension to filenames.</p><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p>The malware is coded using .NET we can determine that using Detect it easy(DiE) Tool: <img loading=lazy src=https://i.imgur.com/p7vCn2p.png alt="enter image description here"></p><h2 id=code-analysis>Code analysis<a hidden class=anchor aria-hidden=true href=#code-analysis>#</a></h2><p>The malware doesn&rsquo;t come packed or something we can just decompile it using <code>dnSpy</code> and start analyzing the code and see its behavior and capabilities.</p><p>At the beginning the malware defines some variables which the author can edit and customize the malware like, (Message, processName, spreadName and Ransomware text message)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22>22</a>
</span><span class=lnt id=hl-0-23><a class=lnlinks href=#hl-0-23>23</a>
</span><span class=lnt id=hl-0-24><a class=lnlinks href=#hl-0-24>24</a>
</span><span class=lnt id=hl-0-25><a class=lnlinks href=#hl-0-25>25</a>
</span><span class=lnt id=hl-0-26><a class=lnlinks href=#hl-0-26>26</a>
</span><span class=lnt id=hl-0-27><a class=lnlinks href=#hl-0-27>27</a>
</span><span class=lnt id=hl-0-28><a class=lnlinks href=#hl-0-28>28</a>
</span><span class=lnt id=hl-0-29><a class=lnlinks href=#hl-0-29>29</a>
</span><span class=lnt id=hl-0-30><a class=lnlinks href=#hl-0-30>30</a>
</span><span class=lnt id=hl-0-31><a class=lnlinks href=#hl-0-31>31</a>
</span><span class=lnt id=hl-0-32><a class=lnlinks href=#hl-0-32>32</a>
</span><span class=lnt id=hl-0-33><a class=lnlinks href=#hl-0-33>33</a>
</span><span class=lnt id=hl-0-34><a class=lnlinks href=#hl-0-34>34</a>
</span><span class=lnt id=hl-0-35><a class=lnlinks href=#hl-0-35>35</a>
</span><span class=lnt id=hl-0-36><a class=lnlinks href=#hl-0-36>36</a>
</span><span class=lnt id=hl-0-37><a class=lnlinks href=#hl-0-37>37</a>
</span><span class=lnt id=hl-0-38><a class=lnlinks href=#hl-0-38>38</a>
</span><span class=lnt id=hl-0-39><a class=lnlinks href=#hl-0-39>39</a>
</span><span class=lnt id=hl-0-40><a class=lnlinks href=#hl-0-40>40</a>
</span><span class=lnt id=hl-0-41><a class=lnlinks href=#hl-0-41>41</a>
</span><span class=lnt id=hl-0-42><a class=lnlinks href=#hl-0-42>42</a>
</span><span class=lnt id=hl-0-43><a class=lnlinks href=#hl-0-43>43</a>
</span><span class=lnt id=hl-0-44><a class=lnlinks href=#hl-0-44>44</a>
</span><span class=lnt id=hl-0-45><a class=lnlinks href=#hl-0-45>45</a>
</span><span class=lnt id=hl-0-46><a class=lnlinks href=#hl-0-46>46</a>
</span><span class=lnt id=hl-0-47><a class=lnlinks href=#hl-0-47>47</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>userName = Environment.UserName;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>userDir = &#34;C:\\Users\\&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>appMutexRun = &#34;7z459ajrk722yn8c5j4fg&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>encryptionAesRsa = true;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>encryptedFileExtension = &#34;skull&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>checkSpread = true;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>spreadName = &#34;skull.exe&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>checkCopyRoaming = true;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>processName = &#34;svchost.exe&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>appMutexRun2 = &#34;2X28tfRmWaPyPQgvoHV&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>checkStartupFolder = true;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>checkSleep = true;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sleepTextbox = 10;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>base64Image = &#34;#base64Image&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>appMutexStartup = &#34;1qw0ll8p9m8uezhqhyd&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>droppedMessageTextbox = &#34;read_it.txt&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>checkAdminPrivilage = true;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>checkdeleteShadowCopies = true;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>checkdisableRecoveryMode = true;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>checkdeleteBackupCatalog = true;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>appMutexStartup2 = &#34;17CqMQFeuB3NTzJ&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>appMutex2 = Program.appMutexStartup2 + Program.appMutexRun2;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>staticSplit = &#34;bc&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>appMutex = Program.staticSplit + Program.appMutexStartup + Program.appMutexRun;
</span></span></code></pre></td></tr></table></div></div><h3 id=already-running>Already Running<a hidden class=anchor aria-hidden=true href=#already-running>#</a></h3><p><img loading=lazy src=https://i.imgur.com/pYKSKcF.png alt="enter image description here">
First, the malware defines a method called <code>AlreadyRunning</code> which checks if there is already an instance of the current process running.</p><p>The method first uses <code>Process.GetProcesses()</code> to get a list of all currently running processes. It then uses <code>Process.GetCurrentProcess()</code> to get a reference to the current process.</p><p>The method then iterates through each of the processes in the list and checks if the first module in the process&rsquo;s module collection has the same file name as the current executing assembly(Malware), which is obtained using <code>Assembly.GetExecutingAssembly().Location</code>, <code>Assembly.GetExecutingAssembly().Location</code> will return the full path of the malware.</p><p>If a process is found that matches these conditions, the method returns true and the application will exit. If no matching process is found, the method returns false.</p><h3 id=check-admin-privilege>Check Admin Privilege<a hidden class=anchor aria-hidden=true href=#check-admin-privilege>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>if  (Program.checkAdminPrivilage)  
</span></span><span class=line><span class=cl>{  
</span></span><span class=line><span class=cl>	Program.copyResistForAdmin(Program.processName);  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>If we take a look at <code>copyResistForAdmin</code> method
<img loading=lazy src=https://i.imgur.com/ZET0yD3.png alt="enter image description here">
<code>private static string processName = "svchost.exe";</code>
We know that the <code>processName</code> is <code>svchost.exe</code> so this method attempts to copy the current executable to a location within the user&rsquo;s <code>/AppData/Roaming/</code> folder using a filename of <code>svchost.exe</code>. Since <code>svchost.exe</code> is a legitimate system process, this an attempt by malware to disguise itself as a legitimate system process and avoid detection. Once the malware has copied itself to the new location and is running as an <code>administrator</code>, it could use this <code>persistence mechanism</code> to remain undetected and ensure that the malware can persist on the victim&rsquo;s machine even after a system reboot or shutdown and if an exception occurs when attempting to start the new <code>process</code> with elevated privileges (the user declines the UAC prompt), the method recursively calls itself using the same <code>processName</code> argument.</p><h3 id=addlinktostartup>addLinkToStartup<a hidden class=anchor aria-hidden=true href=#addlinktostartup>#</a></h3><p><img loading=lazy src=https://i.imgur.com/M0DnAhb.png alt="enter image description here">
This code defines a static method called <code>addLinkToStartup</code> that adds a shortcut to the current executable to <code>%USERPROFILE%\AppData\Roaming\Microsoft\Windows\Start Menu</code> and the name of the shortcut is <code>svchost.url</code>. This method essentially ensures that the current executable will run every time the user logs into the system, making it a persistence mechanism.</p><h3 id=encrypt-directories>Encrypt Directories<a hidden class=anchor aria-hidden=true href=#encrypt-directories>#</a></h3><p>This method is responsible for encrypting directories in the given location.
<img loading=lazy src=https://i.imgur.com/mw6rW3i.png alt="enter image description here">
if we take a look at <code>lookForDirectories</code>
<img loading=lazy src=https://i.imgur.com/BvQWni3.png alt="enter image description here">
and it calls method named <code>encryptDirectory</code> and this method gets a list of all files in the given location using <code>.GetFiles</code> function, then loops through each file and this
<code>if (Array.Exists&lt;string>(Program.validExtensions, (string E) => E == extension.ToLower()) && fileName != Program.droppedMessageTextbox)</code> checks if the file extension is in the <code>validExtensions</code> array and is not the <code>droppedMessageTextbox</code> and we know that <code>droppedMessageTextbox = "read_it.txt";</code> and this file <code>read_it.txt</code> has the message that the victim sees after the encryption process finished. And these are the targeted folders
<img loading=lazy src=https://i.imgur.com/XL5MaZ3.png alt="enter image description here">
Also these are the <code>validExtensions</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#34;.txt&#34;,&#34;.jar&#34;,&#34;.dat&#34;,&#34;.contact&#34;,&#34;.settings&#34;,&#34;.doc&#34;,&#34;.docx&#34;,&#34;.xls&#34;,&#34;.xlsx&#34;,&#34;.ppt&#34;,&#34;.pptx&#34;,&#34;.odt&#34;,&#34;.jpg&#34;,&#34;.mka&#34;,&#34;.mhtml&#34;,&#34;.oqy&#34;,&#34;.png&#34;,&#34;.csv&#34;,&#34;.py&#34;,&#34;.sql&#34;,&#34;.mdb&#34;,&#34;.php&#34;,&#34;.asp&#34;,&#34;.aspx&#34;,&#34;.html&#34;,&#34;.htm&#34;,&#34;.xml&#34;,&#34;.psd&#34;,&#34;.pdf&#34;,&#34;.xla&#34;,&#34;.cub&#34;,&#34;.dae&#34;,&#34;.indd&#34;,&#34;.cs&#34;,&#34;.mp3&#34;,&#34;.mp4&#34;,&#34;.dwg&#34;,&#34;.zip&#34;,&#34;.rar&#34;,&#34;.mov&#34;,&#34;.rtf&#34;,&#34;.bmp&#34;,&#34;.mkv&#34;,&#34;.avi&#34;,&#34;.apk&#34;,&#34;.lnk&#34;,&#34;.dib&#34;,&#34;.dic&#34;,&#34;.dif&#34;,&#34;.divx&#34;,&#34;.iso&#34;,&#34;.7zip&#34;,&#34;.ace&#34;,&#34;.arj&#34;,&#34;.bz2&#34;,&#34;.cab&#34;,&#34;.gzip&#34;,&#34;.lzh&#34;,&#34;.tar&#34;,&#34;.jpeg&#34;,&#34;.xz&#34;,&#34;.mpeg&#34;,&#34;.torrent&#34;,&#34;.mpg&#34;,&#34;.core&#34;,&#34;.pdb&#34;,&#34;.ico&#34;,&#34;.pas&#34;,&#34;.db&#34;,&#34;.wmv&#34;,&#34;.swf&#34;,&#34;.cer&#34;,&#34;.bak&#34;,&#34;.backup&#34;,&#34;.accdb&#34;,&#34;.bay&#34;,&#34;.p7c&#34;,&#34;.exif&#34;,&#34;.vss&#34;,&#34;.raw&#34;,&#34;.m4a&#34;,&#34;.wma&#34;,&#34;.flv&#34;,&#34;.sie&#34;,&#34;.sum&#34;,&#34;.ibank&#34;,&#34;.wallet&#34;,&#34;.css&#34;,&#34;.js&#34;,&#34;.rb&#34;,&#34;.crt&#34;,&#34;.xlsm&#34;,&#34;.xlsb&#34;,&#34;.7z&#34;,&#34;.cpp&#34;,&#34;.java&#34;,&#34;.jpe&#34;,&#34;.ini&#34;,&#34;.blob&#34;,&#34;.wps&#34;,&#34;.docm&#34;,&#34;.wav&#34;,&#34;.3gp&#34;,&#34;.webm&#34;,&#34;.m4v&#34;,&#34;.amv&#34;,&#34;.m4p&#34;,&#34;.svg&#34;,&#34;.ods&#34;,&#34;.bk&#34;,&#34;.vdi&#34;,&#34;.vmdk&#34;,&#34;.onepkg&#34;,&#34;.accde&#34;,&#34;.jsp&#34;,&#34;.json&#34;,&#34;.gif&#34;,&#34;.log&#34;,&#34;.gz&#34;,&#34;.config&#34;,&#34;.vb&#34;,&#34;.m1v&#34;,&#34;.sln&#34;,&#34;.pst&#34;,&#34;.obj&#34;,&#34;.xlam&#34;,&#34;.djvu&#34;,&#34;.inc&#34;,&#34;.cvs&#34;,&#34;.dbf&#34;,&#34;.tbi&#34;,&#34;.wpd&#34;,&#34;.dot&#34;,&#34;.dotx&#34;,&#34;.xltx&#34;,&#34;.pptm&#34;,&#34;.potx&#34;,&#34;.potm&#34;,&#34;.pot&#34;,&#34;.xlw&#34;,&#34;.xps&#34;,&#34;.xsd&#34;,&#34;.xsf&#34;,&#34;.xsl&#34;,&#34;.kmz&#34;,&#34;.accdr&#34;,&#34;.stm&#34;,&#34;.accdt&#34;,&#34;.ppam&#34;,&#34;.pps&#34;,&#34;.ppsm&#34;,&#34;.1cd&#34;,&#34;.3ds&#34;,&#34;.3fr&#34;,&#34;.3g2&#34;,&#34;.accda&#34;,&#34;.accdc&#34;,&#34;.accdw&#34;,&#34;.adp&#34;,&#34;.ai&#34;,&#34;.ai3&#34;,&#34;.ai4&#34;,&#34;.ai5&#34;,&#34;.ai6&#34;,&#34;.ai7&#34;,&#34;.ai8&#34;,&#34;.arw&#34;,&#34;.ascx&#34;,&#34;.asm&#34;,&#34;.asmx&#34;,&#34;.avs&#34;,&#34;.bin&#34;,&#34;.cfm&#34;,&#34;.dbx&#34;,&#34;.dcm&#34;,&#34;.dcr&#34;,&#34;.pict&#34;,&#34;.rgbe&#34;,&#34;.dwt&#34;,&#34;.f4v&#34;,&#34;.exr&#34;,&#34;.kwm&#34;,&#34;.max&#34;,&#34;.mda&#34;,&#34;.mde&#34;,&#34;.mdf&#34;,&#34;.mdw&#34;,&#34;.mht&#34;,&#34;.mpv&#34;,&#34;.msg&#34;,&#34;.myi&#34;,&#34;.nef&#34;,&#34;.odc&#34;,&#34;.geo&#34;,&#34;.swift&#34;,&#34;.odm&#34;,&#34;.odp&#34;,&#34;.oft&#34;,&#34;.orf&#34;,&#34;.pfx&#34;,&#34;.p12&#34;,&#34;.pl&#34;,&#34;.pls&#34;,&#34;.safe&#34;,&#34;.tab&#34;,&#34;.vbs&#34;,&#34;.xlk&#34;,&#34;.xlm&#34;,&#34;.xlt&#34;,&#34;.xltm&#34;,&#34;.svgz&#34;,&#34;.slk&#34;,&#34;.tar.gz&#34;,&#34;.dmg&#34;,&#34;.ps&#34;,&#34;.psb&#34;,&#34;.tif&#34;,&#34;.rss&#34;,&#34;.key&#34;,&#34;.vob&#34;,&#34;.epsp&#34;,&#34;.dc3&#34;,&#34;.iff&#34;,&#34;.onepkg&#34;,&#34;.onetoc2&#34;,&#34;.opt&#34;,&#34;.p7b&#34;,&#34;.pam&#34;,&#34;.r3d&#34;
</span></span></code></pre></td></tr></table></div></div><p>if the file size is less than 2MB it is encrypted using the <code>EncryptFile</code> method and if the size is bigger than 200 MB
a random string of a random length between 200000000 and 300000000 bytes is generated and encoded using the <code>randomEncode</code> method after that, the original file renamed to a random 4-character extension using <code>RandomStringForExtension</code>.</p><h3 id=encrypt-file>Encrypt File<a hidden class=anchor aria-hidden=true href=#encrypt-file>#</a></h3><p><img loading=lazy src=https://i.imgur.com/vkSDLz8.png alt="enter image description here">
used to encrypt a file using <code>AES encryption algorithm</code> with a randomly generated password. The method reads the contents of the file into a byte array, generates a random password using the <code>CreatePassword</code> method, and converts the password to a byte array using UTF8 encoding. The method then writes the encrypted key and the encrypted content to the file. The encrypted key is the RSA encrypted random password generated earlier, and the <code>encrypted content</code> is the output of the <code>AES encryption</code>. Both of these are concatenated and written to the file using the <code>File.WriteAllText</code> method.
Finally, the method renames the original file by appending a random extension using the <code>RandomStringForExtension</code> method</p><h3 id=registry-startup>Registry Startup<a hidden class=anchor aria-hidden=true href=#registry-startup>#</a></h3><p><img loading=lazy src=https://i.imgur.com/4MZRTFp.png alt="enter image description here"></p><p>This method adds the path of the current executable to the Windows registry <code>SOFTWARE\Microsoft\Windows\CurrentVersion\Run</code> named <code>Microsoft Store</code> also used for persistence.</p><h3 id=spread-it>Spread It<a hidden class=anchor aria-hidden=true href=#spread-it>#</a></h3><p><img loading=lazy src=https://i.imgur.com/oIZWjkk.png alt="enter image description here">
<code>private static string spreadName = "skull.exe";</code>
This code is responsible for spreading the malware to other drives on the victim&rsquo;s machine. It loops through all the available drives on the system using the <code>DriveInfo.GetDrives()</code> method and checks if the drive is not the <code>C:\</code> drive and if a file with the <code>spreadName</code> doesn&rsquo;t exist in that drive. If both conditions are true, it copies the malware&rsquo;s executable file to that drive with the specified <code>spreadName</code>. This way, the malware can potentially infect other machines or systems that are connected to those drives.</p><h3 id=malware-message>Malware Message<a hidden class=anchor aria-hidden=true href=#malware-message>#</a></h3><p><img loading=lazy src=https://i.imgur.com/4Ozgy53.png alt="enter image description here"></p><p>This code is responsible for creating a file with <code>droppedMessageTextbox</code> value and we already know the name of the file <code>private static string droppedMessageTextbox = "read_it.txt";</code> and then write the content of the <code>Program.messages</code> value into it and then open the file to the victim to let him know that his files have been encrypted. The message variable written in polish translate it by yourself :D
<img loading=lazy src=https://i.imgur.com/rafqPBx.png alt="enter image description here"></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Witaj,
</span></span><span class=line><span class=cl>Twoje pliki zostały zaszyfrowane przez SkullLocker ransomware. Aby odzyskać dostęp do nich musizapłacić okup w ciągu 72 godzin. W przeciwnym razie dane zostaną trwale utracone.
</span></span><span class=line><span class=cl>			
</span></span><span class=line><span class=cl>Aby uzyskać więcej informacji na temat sposobu zapłaty okupu i odzyskiwania plików przejdź na stronę internetową podaną poniżej.
</span></span><span class=line><span class=cl>			
</span></span><span class=line><span class=cl>U6cQ2nV4KzL3H8jxSdGhTfMlR0N1wX7eJbO9mZyIaP5pgqWvEoBkYtAxDsFi.onion
</span></span><span class=line><span class=cl>			
</span></span><span class=line><span class=cl>Jeśli masz jakiekolwiek pytania możesz skontaktować się z nami za pomocą adresu e-mail [adres e-mail].
</span></span><span class=line><span class=cl>			
</span></span><span class=line><span class=cl>Nie próbuj usuwać programu ransomware ani próbować odzyskać danych za pomocą oprogramowania antywirusowego. Może to spowodować trwałe uszkodzenie Twoich plików.
</span></span><span class=line><span class=cl>			
</span></span><span class=line><span class=cl>Pamiętaj że czas jest kluczowy. Im dłużej zwlekasz tym mniejsze szanse na odzyskanie Twoich plików.
</span></span><span class=line><span class=cl>			
</span></span><span class=line><span class=cl>Pozdrawiamy
</span></span><span class=line><span class=cl>Zespół ransomware
</span></span></code></pre></td></tr></table></div></div><h3 id=ransom-wallet-addresses>Ransom Wallet Addresses<a hidden class=anchor aria-hidden=true href=#ransom-wallet-addresses>#</a></h3><p><img loading=lazy src=https://i.imgur.com/AuOd1lr.png alt="enter image description here"></p><p>The code first reads the current contents of the clipboard using a method called <code>GetText</code> from a <code>NotificationForm</code> object. If the clipboard text starts with the string &ldquo;bc1&rdquo;, the code seems to be manipulating the contents of the clipboard to ensure that certain strings are present or replaced with specific values and the values are stored in <code>appMutex2</code> and <code>appMutex</code> if we went back to the variables that at the beginning we will notice that <code>appMutex = Program.staticSplit + Program.appMutexStartup + Program.appMutexRun;</code>and <code>appMutex2 = Program.appMutexStartup2 + Program.appMutexRun2;</code>after we concatenate these values together we will get <code>2 Bitcoin Wallets</code> <img loading=lazy src=https://i.imgur.com/mKLm6jR.png alt="enter image description here"></p><p>So, using Threat Intel we can determine if there is wallet with this address by going to Blockchain.
<img loading=lazy src=https://i.imgur.com/AWShbgI.png alt="enter image description here"></p><h3 id=change-wallpaper>Change Wallpaper<a hidden class=anchor aria-hidden=true href=#change-wallpaper>#</a></h3><p><img loading=lazy src=https://i.imgur.com/JvQQEye.png alt="enter image description here">
First <code>base64Image</code> has the base64 of the wallpaper then it attempts to write the decoded bytes to a temporary file with a random name and a &ldquo;.jpg&rdquo; extension. Then, it calls the <code>SystemParametersInfo</code> function with the parameters <code>20U (indicating that the desktop wallpaper should be changed)</code>,<code> 0U (indicating that the wallpaper should be changed immediately)</code>, the path to the temporary file, and <code>3U (indicating that the wallpaper should be tiled)</code>.</p><h3 id=delete-shadow-copies>Delete Shadow Copies<a hidden class=anchor aria-hidden=true href=#delete-shadow-copies>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>private  static  void  deleteShadowCopies()  
</span></span><span class=line><span class=cl>{  
</span></span><span class=line><span class=cl>	Program.runCommand(&#34;vssadmin delete shadows /all /quiet &amp; wmic shadowcopy delete&#34;);  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>This code invokes two command-line tools, <code>vssadmin</code> and <code>wmic</code>, to delete all the existing shadow copies on the victim&rsquo;s machine. The code is effectively preventing the victim from restoring their data using the shadow copies.</p><h3 id=delete-backup>Delete backup<a hidden class=anchor aria-hidden=true href=#delete-backup>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>private  static  void  deleteBackupCatalog()  
</span></span><span class=line><span class=cl>{  
</span></span><span class=line><span class=cl>	Program.runCommand(&#34;wbadmin delete catalog -quiet&#34;);  
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>This command is used to delete the backup catalog on a local Windows computer without prompting the user for confirmation.</p><h2 id=mapping-to-mitre>Mapping to MITRE<a hidden class=anchor aria-hidden=true href=#mapping-to-mitre>#</a></h2><table><thead><tr><th>ID</th><th>Tactics</th><th>Technique</th><th>Description</th></tr></thead><tbody><tr><td>T1547.001</td><td>Persistence, Privilege Escalation</td><td>Boot or Logon Autostart Execution</td><td>Adversaries may achieve persistence by adding a program to a startup folder or referencing it with a Registry run key. Adding an entry to the &ldquo;run keys&rdquo; in the Registry or startup folder will cause the program referenced to be executed when a user logs in. These programs will be executed under the context of the user and will have the account&rsquo;s associated permissions level. Placing a program within a startup folder will also cause that program to execute when a user logs in. There is a startup folder location for individual user accounts as well as a system-wide startup folder that will be checked regardless of which user account logs in. The startup folder path for the current user is C:\Users[Username]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</td></tr><tr><td>T1037.005</td><td>Persistence, Privilege Escalation</td><td>Boot or Logon Initialization Scripts</td><td>Adversaries may use scripts automatically executed at boot or logon initialization to establish persistence. Initialization scripts can be used to perform administrative functions, which may often execute other programs or send information to an internal logging server. These scripts can vary based on operating system and whether applied locally or remotely.</td></tr><tr><td>T1027</td><td>Defense Evasion</td><td>Obfuscated Files or Information</td><td>Encode data using Base64, Encrypt data using AES via .NET</td></tr><tr><td>T1070.004</td><td>Defense Evasion</td><td>Indicator Removal: File Deletion</td><td>Adversaries may delete files left behind by the actions of their intrusion activity. Deletes the backup plan of Windows, Deletes shadow drive data (related to ransomware)</td></tr><tr><td>T1471</td><td>Impact</td><td>Data Encrypted for Impact</td><td>The adversary is trying to manipulate, interrupt, or destroy your devices and data and hold it for ransom</td></tr></tbody></table><h2 id=iocs>IOCs<a hidden class=anchor aria-hidden=true href=#iocs>#</a></h2><table><thead><tr><th>Indicator Type</th><th>Value</th></tr></thead><tbody><tr><td>SHA256</td><td>bb5ca9d8de51734dbd14dc081c7c892d819cd14fafd7ccd62849d70f9e679369</td></tr></tbody></table><h2 id=yara-rule>Yara Rule<a hidden class=anchor aria-hidden=true href=#yara-rule>#</a></h2><pre><code>rule skull_locker {
    meta:
        author = &quot;R1ddl3&quot;
        description = &quot;Yara rule for detecting SkullLocker Ransomware&quot;
        hash = &quot;bb5ca9d8de51734dbd14dc081c7c892d819cd14fafd7ccd62849d70f9e679369&quot;
    strings:
        $mz = { 4D 5A }           // PE file
        $str1 = &quot;skull.exe&quot;
        $str2 = &quot;checkCopyRoaming&quot;
        $str3 = &quot;appMutexRegex&quot;
        $str4 = &quot;copyResistForAdmin&quot;
        $str5 = &quot;deleteShadowCopies&quot;
        $str6 = &quot;lookForDirectories&quot;
        $str7 = &quot;spreadIt&quot;
        $str8 = &quot;appMutexRun2&quot;
        $str9 = &quot;appMutexRun&quot;
        $str10 = &quot;checkSpread&quot;

    condition:
        ($mz at 0) and (4 of ($str*)) and (hash.sha256() == $hash or not $hash)
}
</code></pre><p>&ndash; Thanks for reading, hope you enjoyed.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://r1ddll3.github.io/tags/malware-analysis/>Malware Analysis</a></li><li><a href=https://r1ddll3.github.io/tags/reverse-engineering/>Reverse engineering</a></li><li><a href=https://r1ddll3.github.io/tags/skulllocker/>SkullLocker</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Analyze - SkullLocker Ransomware on twitter" href="https://twitter.com/intent/tweet/?text=Analyze%20-%20SkullLocker%20Ransomware&url=https%3a%2f%2fr1ddll3.github.io%2fmalware-analysis%2fskulllocker%2f&hashtags=MalwareAnalysis%2cReverseengineering%2cSkullLocker"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Analyze - SkullLocker Ransomware on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fr1ddll3.github.io%2fmalware-analysis%2fskulllocker%2f&title=Analyze%20-%20SkullLocker%20Ransomware&summary=Analyze%20-%20SkullLocker%20Ransomware&source=https%3a%2f%2fr1ddll3.github.io%2fmalware-analysis%2fskulllocker%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Analyze - SkullLocker Ransomware on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fr1ddll3.github.io%2fmalware-analysis%2fskulllocker%2f&title=Analyze%20-%20SkullLocker%20Ransomware"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Analyze - SkullLocker Ransomware on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fr1ddll3.github.io%2fmalware-analysis%2fskulllocker%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Analyze - SkullLocker Ransomware on whatsapp" href="https://api.whatsapp.com/send?text=Analyze%20-%20SkullLocker%20Ransomware%20-%20https%3a%2f%2fr1ddll3.github.io%2fmalware-analysis%2fskulllocker%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Analyze - SkullLocker Ransomware on telegram" href="https://telegram.me/share/url?text=Analyze%20-%20SkullLocker%20Ransomware&url=https%3a%2f%2fr1ddll3.github.io%2fmalware-analysis%2fskulllocker%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://r1ddll3.github.io>R1ddl3 Edition</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>